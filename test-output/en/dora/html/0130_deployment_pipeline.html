<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>0130 - Deployment Pipeline</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="template-number">0130</div>
            <h1>Deployment Pipeline</h1>
        </header>
        
        <nav class="page-nav">
<a href="0120_deployment_automation.html" class="nav-prev">← Previous</a>
<a href="index.html" class="nav-toc">Table of Contents</a>
<a href="0150_quality_assurance_practices.html" class="nav-next">Next →</a>
        </nav>
        
        <main>
<p>Document-ID: dora-0130</p>
<p>Status: Draft
Classification: Internal</p>
<h1 id="deployment-pipeline">Deployment Pipeline</h1>
<p><strong>Document-ID:</strong> [FRAMEWORK]-0130
<strong>Organisation:</strong> AdminSend GmbH
<strong>Owner:</strong> [TODO]
<strong>Approved by:</strong> [TODO]
<strong>Revision:</strong> [TODO]
<strong>Author:</strong> Handbook-Generator
<strong>Status:</strong> Draft
<strong>Classification:</strong> Internal
<strong>Last Update:</strong> [TODO]
<strong>Template Version:</strong> [TODO]</p>
<hr />
<hr />
<h2 id="purpose">Purpose</h2>
<p>This document describes the structure, configuration, and optimization of deployment pipelines for continuous software delivery.</p>
<h2 id="scope">Scope</h2>
<p>This document covers:
- Pipeline architecture and design
- Stage definitions and configuration
- Quality gates and approval processes
- Pipeline optimization and monitoring</p>
<h2 id="pipeline-architecture">Pipeline Architecture</h2>
<h3 id="organization-information">Organization Information</h3>
<ul>
<li><strong>Organization</strong>: [TODO]</li>
<li><strong>Pipeline Owner</strong>: [TODO]</li>
<li><strong>CI/CD Platform</strong>: [TODO]</li>
<li><strong>Pipeline Repository</strong>: [TODO]</li>
</ul>
<h2 id="pipeline-stages">Pipeline Stages</h2>
<h3 id="1-source-stage">1. Source Stage</h3>
<p><strong>Purpose</strong>: Code checkout and preparation</p>
<p><strong>Activities</strong>:
- Repository checkout
- Submodule initialization
- Dependency caching
- Workspace setup</p>
<p><strong>Configuration</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">source</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">source</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">git submodule update --init --recursive</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;Source checkout complete&quot;</span>
<span class="w">  </span><span class="nt">cache</span><span class="p">:</span>
<span class="w">    </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${CI_COMMIT_REF_SLUG}</span>
<span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node_modules/</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.cache/</span>
</code></pre></div>

<h3 id="2-build-stage">2. Build Stage</h3>
<p><strong>Purpose</strong>: Compilation and artifact creation</p>
<p><strong>Activities</strong>:
- Dependency installation
- Code compilation
- Asset generation
- Artifact packaging</p>
<p><strong>Configuration</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">build</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm ci</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm run build</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm run package</span>
<span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;${CI_PROJECT_NAME}-${CI_COMMIT_SHORT_SHA}&quot;</span>
<span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dist/</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build/</span>
<span class="w">    </span><span class="nt">expire_in</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1 week</span>
<span class="w">  </span><span class="nt">only</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">branches</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tags</span>
</code></pre></div>

<h3 id="3-test-stage">3. Test Stage</h3>
<p><strong>Purpose</strong>: Quality assurance through automated tests</p>
<p><strong>Unit Tests</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">test:unit</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm run test:unit</span>
<span class="w">  </span><span class="nt">coverage</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/Coverage:</span><span class="nv"> </span><span class="s">\d+\.\d+%/&#39;</span>
<span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
<span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
<span class="w">      </span><span class="nt">junit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">junit.xml</span>
<span class="w">      </span><span class="nt">coverage_report</span><span class="p">:</span>
<span class="w">        </span><span class="nt">coverage_format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cobertura</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">coverage/cobertura-coverage.xml</span>
</code></pre></div>

<p><strong>Integration Tests</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">test:integration</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">  </span><span class="nt">services</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:6</span>
<span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
<span class="w">    </span><span class="nt">DATABASE_URL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;postgresql://test:test@postgres:5432/testdb&quot;</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm run test:integration</span>
</code></pre></div>

<p><strong>E2E Tests</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">test:e2e</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm run test:e2e</span>
<span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">on_failure</span>
<span class="w">    </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cypress/screenshots/</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cypress/videos/</span>
</code></pre></div>

<h3 id="4-security-stage">4. Security Stage</h3>
<p><strong>Purpose</strong>: Security checks and vulnerability scanning</p>
<p><strong>Dependency Scanning</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">security:dependencies</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">security</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm audit --audit-level=moderate</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm run security:check</span>
<span class="w">  </span><span class="nt">allow_failure</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</code></pre></div>

<p><strong>SAST (Static Application Security Testing)</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">security:sast</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">security</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">semgrep --config=auto .</span>
<span class="w">  </span><span class="nt">artifacts</span><span class="p">:</span>
<span class="w">    </span><span class="nt">reports</span><span class="p">:</span>
<span class="w">      </span><span class="nt">sast</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gl-sast-report.json</span>
</code></pre></div>

<p><strong>Container Scanning</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">security:container</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">security</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">trivy image --severity HIGH,CRITICAL ${CI_REGISTRY_IMAGE}:${CI_COMMIT_SHA}</span>
</code></pre></div>

<h3 id="5-quality-stage">5. Quality Stage</h3>
<p><strong>Purpose</strong>: Code quality checks</p>
<p><strong>Linting</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">quality:lint</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quality</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm run lint</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm run format:check</span>
</code></pre></div>

<p><strong>Code Quality Analysis</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">quality:sonar</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quality</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sonar-scanner</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">-Dsonar.projectKey=${CI_PROJECT_NAME}</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">-Dsonar.sources=src</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">-Dsonar.host.url=${SONAR_HOST_URL}</span>
<span class="w">      </span><span class="l l-Scalar l-Scalar-Plain">-Dsonar.login=${SONAR_TOKEN}</span>
</code></pre></div>

<h3 id="6-package-stage">6. Package Stage</h3>
<p><strong>Purpose</strong>: Container image creation and registration</p>
<p><strong>Docker Build</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">package:docker</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">package</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker build -t ${CI_REGISTRY_IMAGE}:${CI_COMMIT_SHA} .</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker tag ${CI_REGISTRY_IMAGE}:${CI_COMMIT_SHA} ${CI_REGISTRY_IMAGE}:latest</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker push ${CI_REGISTRY_IMAGE}:${CI_COMMIT_SHA}</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker push ${CI_REGISTRY_IMAGE}:latest</span>
<span class="w">  </span><span class="nt">only</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tags</span>
</code></pre></div>

<h3 id="7-deploy-stage">7. Deploy Stage</h3>
<p><strong>Purpose</strong>: Deployment to target environments</p>
<p><strong>Development Deployment</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">deploy:dev</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubectl set image deployment/${APP_NAME} ${APP_NAME}=${CI_REGISTRY_IMAGE}:${CI_COMMIT_SHA}</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubectl rollout status deployment/${APP_NAME}</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">development</span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://dev.[TODO]</span>
<span class="w">  </span><span class="nt">only</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">develop</span>
</code></pre></div>

<p><strong>Staging Deployment</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">deploy:staging</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./deploy.sh staging ${CI_COMMIT_SHA}</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://staging.[TODO]</span>
<span class="w">  </span><span class="nt">only</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
<span class="w">  </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</code></pre></div>

<p><strong>Production Deployment</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">deploy:production</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./deploy.sh production ${CI_COMMIT_SHA}</span>
<span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
<span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://[TODO]</span>
<span class="w">  </span><span class="nt">only</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tags</span>
<span class="w">  </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</code></pre></div>

<h2 id="quality-gates">Quality Gates</h2>
<h3 id="automatic-quality-gates">Automatic Quality Gates</h3>
<p><strong>Test Coverage Gate</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">coverage_gate</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quality</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">COVERAGE=$(cat coverage/coverage-summary.json | jq &#39;.total.lines.pct&#39;)</span>
<span class="w">      </span><span class="no">if (( $(echo &quot;$COVERAGE &lt; 80&quot; | bc -l) )); then</span>
<span class="w">        </span><span class="no">echo &quot;Coverage $COVERAGE% is below threshold 80%&quot;</span>
<span class="w">        </span><span class="no">exit 1</span>
<span class="w">      </span><span class="no">fi</span>
</code></pre></div>

<p><strong>Performance Gate</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">performance_gate</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">quality</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm run test:performance</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">RESPONSE_TIME=$(cat performance-report.json | jq &#39;.avg_response_time&#39;)</span>
<span class="w">      </span><span class="no">if (( $(echo &quot;$RESPONSE_TIME &gt; 200&quot; | bc -l) )); then</span>
<span class="w">        </span><span class="no">echo &quot;Response time ${RESPONSE_TIME}ms exceeds threshold 200ms&quot;</span>
<span class="w">        </span><span class="no">exit 1</span>
<span class="w">      </span><span class="no">fi</span>
</code></pre></div>

<p><strong>Security Gate</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">security_gate</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">security</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">VULNERABILITIES=$(npm audit --json | jq &#39;.metadata.vulnerabilities.high + .metadata.vulnerabilities.critical&#39;)</span>
<span class="w">      </span><span class="no">if [ &quot;$VULNERABILITIES&quot; -gt 0 ]; then</span>
<span class="w">        </span><span class="no">echo &quot;Found $VULNERABILITIES high/critical vulnerabilities&quot;</span>
<span class="w">        </span><span class="no">exit 1</span>
<span class="w">      </span><span class="no">fi</span>
</code></pre></div>

<h3 id="manual-approval-gates">Manual Approval Gates</h3>
<p><strong>Staging Approval</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">approve:staging</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">approve</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;Awaiting staging approval&quot;</span>
<span class="w">  </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
<span class="w">  </span><span class="nt">only</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
</code></pre></div>

<p><strong>Production Approval</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">approve:production</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">approve</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;Awaiting production approval&quot;</span>
<span class="w">  </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
<span class="w">  </span><span class="nt">allow_failure</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">  </span><span class="nt">only</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tags</span>
</code></pre></div>

<h2 id="pipeline-optimization">Pipeline Optimization</h2>
<h3 id="parallelization">Parallelization</h3>
<p><strong>Parallel Test Execution</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">test:unit</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">  </span><span class="nt">parallel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm run test:unit -- --shard=${CI_NODE_INDEX}/${CI_NODE_TOTAL}</span>
</code></pre></div>

<p><strong>Matrix Builds</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">test:compatibility</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">  </span><span class="nt">parallel</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matrix</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">NODE_VERSION</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;14&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;16&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;18&#39;</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">OS</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;ubuntu&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&#39;alpine&#39;</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node:${NODE_VERSION}-${OS}</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm run test</span>
</code></pre></div>

<h3 id="caching-strategies">Caching Strategies</h3>
<p><strong>Dependency Caching</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">cache</span><span class="p">:</span>
<span class="w">  </span><span class="nt">key</span><span class="p">:</span>
<span class="w">    </span><span class="nt">files</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">package-lock.json</span>
<span class="w">  </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node_modules/</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.npm/</span>
<span class="w">  </span><span class="nt">policy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pull-push</span>
</code></pre></div>

<p><strong>Build Caching</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">cache</span><span class="p">:</span>
<span class="w">  </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${CI_COMMIT_REF_SLUG}</span>
<span class="w">  </span><span class="nt">paths</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.cache/</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dist/</span>
<span class="w">  </span><span class="nt">policy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pull</span>
</code></pre></div>

<h3 id="conditional-execution">Conditional Execution</h3>
<p><strong>Path-based Triggers</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">test:frontend</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm run test:frontend</span>
<span class="w">  </span><span class="nt">only</span><span class="p">:</span>
<span class="w">    </span><span class="nt">changes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">src/frontend/**/*</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">package.json</span>
</code></pre></div>

<p><strong>Branch-based Execution</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">deploy:production</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./deploy.sh production</span>
<span class="w">  </span><span class="nt">only</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/^release-.*$/</span>
<span class="w">  </span><span class="nt">except</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">schedules</span>
</code></pre></div>

<h2 id="pipeline-monitoring">Pipeline Monitoring</h2>
<h3 id="metrics">Metrics</h3>
<p><strong>Pipeline Performance</strong>:
- Average pipeline duration
- Success/Failure rate
- Stage-specific duration
- Queue time</p>
<p><strong>Deployment Metrics</strong>:
- Deployment frequency
- Lead time
- Change failure rate
- Mean time to recovery</p>
<h3 id="alerting">Alerting</h3>
<p><strong>Pipeline Failures</strong>:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">notify:failure</span><span class="p">:</span>
<span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.post</span>
<span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no">curl -X POST ${SLACK_WEBHOOK_URL} \</span>
<span class="w">        </span><span class="no">-H &#39;Content-Type: application/json&#39; \</span>
<span class="w">        </span><span class="no">-d &quot;{</span>
<span class="w">          </span><span class="no">\&quot;text\&quot;: \&quot;Pipeline failed for ${CI_PROJECT_NAME} on ${CI_COMMIT_REF_NAME}\&quot;,</span>
<span class="w">          </span><span class="no">\&quot;attachments\&quot;: [{</span>
<span class="w">            </span><span class="no">\&quot;color\&quot;: \&quot;danger\&quot;,</span>
<span class="w">            </span><span class="no">\&quot;fields\&quot;: [{</span>
<span class="w">              </span><span class="no">\&quot;title\&quot;: \&quot;Commit\&quot;,</span>
<span class="w">              </span><span class="no">\&quot;value\&quot;: \&quot;${CI_COMMIT_SHORT_SHA}\&quot;,</span>
<span class="w">              </span><span class="no">\&quot;short\&quot;: true</span>
<span class="w">            </span><span class="no">}]</span>
<span class="w">          </span><span class="no">}]</span>
<span class="w">        </span><span class="no">}&quot;</span>
<span class="w">  </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">on_failure</span>
</code></pre></div>

<h3 id="dashboard">Dashboard</h3>
<p><strong>Metrics Visualization</strong>:
- Grafana dashboards
- Pipeline trends
- Deployment statistics
- Quality metrics</p>
<h2 id="best-practices">Best Practices</h2>
<h3 id="pipeline-design">Pipeline Design</h3>
<ol>
<li><strong>Fail Fast</strong>: Quick tests first</li>
<li><strong>Parallelization</strong>: Execute independent stages in parallel</li>
<li><strong>Caching</strong>: Reuse artifacts</li>
<li><strong>Idempotency</strong>: Repeatable execution</li>
<li><strong>Observability</strong>: Comprehensive logging and monitoring</li>
</ol>
<h3 id="security">Security</h3>
<ol>
<li><strong>Secrets Management</strong>: No secrets in code</li>
<li><strong>Least Privilege</strong>: Minimal permissions</li>
<li><strong>Audit Logging</strong>: Complete traceability</li>
<li><strong>Vulnerability Scanning</strong>: Automatic security checks</li>
</ol>
<h3 id="maintenance">Maintenance</h3>
<ol>
<li><strong>Pipeline as Code</strong>: Version control</li>
<li><strong>Documentation</strong>: Inline comments</li>
<li><strong>Regular Updates</strong>: Tool and dependency updates</li>
<li><strong>Monitoring</strong>: Continuous monitoring</li>
</ol>
        </main>
        
        <nav class="page-nav">
<a href="0120_deployment_automation.html" class="nav-prev">← Previous</a>
<a href="index.html" class="nav-toc">Table of Contents</a>
<a href="0150_quality_assurance_practices.html" class="nav-next">Next →</a>
        </nav>
        
        <footer>
            <p>Generated by Handbook Generator</p>
        </footer>
    </div>
</body>
</html>